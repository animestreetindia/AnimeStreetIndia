<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>

<style>
body{background:#000;color:#fff;font-family:Arial;padding:10px}
.box{max-width:900px;margin:auto;background:#111;padding:15px;border-radius:10px}
input,select,textarea,button{
 width:100%;padding:10px;margin:6px 0;border-radius:6px;border:none
}
textarea{height:70px}
button{background:red;color:white;font-weight:bold;cursor:pointer}
.card{border:1px solid red;padding:10px;margin:10px 0;border-radius:8px}
h2{text-align:center;color:red}
#panel{display:none}
hr{border:1px solid #333;margin:15px 0}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="box">
<h2>Admin Login</h2>
<input id="loginEmail" placeholder="Email">
<input id="loginPass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<!-- PANEL -->
<div id="panel" class="box">

<h2>Anime Manager</h2>

<input id="aName" placeholder="Anime Name">
<input id="aImg" placeholder="Poster URL">
<input id="aLang" placeholder="Language">
<input id="aGenre" placeholder="Genre">
<select id="aType">
  <option value="Anime">Anime</option>
  <option value="Movie">Movie</option>
</select>
<textarea id="aDesc" placeholder="Description"></textarea>

<button onclick="saveAnime()">Save / Update Anime</button>

<h3>Anime List</h3>
<div id="animeList"></div>

<hr>

<h2>Episode Manager</h2>

<select id="animeSelect"></select>
<input id="epTitle" placeholder="Episode Title (Eg: Episode 1)">
<input id="epLink1" placeholder="Server 1 Link">
<input id="epLink2" placeholder="Server 2 Link">
<input id="epLink3" placeholder="Server 3 Link">

<button onclick="saveEpisode()">Save / Update Episode</button>

<h3>Episode List</h3>
<div id="episodeList"></div>

<button onclick="logout()">Logout</button>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyDCS8ijIYoQ3Ho4nduNOs9XmYQtjeT9Jc0",
  authDomain: "animeshreet.firebaseapp.com",
  projectId: "animeshreet"
};
firebase.initializeApp(firebaseConfig);

var auth = firebase.auth();
var db = firebase.firestore();

let editAnimeId=null;
let editEpisodeId=null;

/* AUTH */
auth.onAuthStateChanged(user=>{
  if(user){
    loginBox.style.display="none";
    panel.style.display="block";
    loadAnime();
    loadEpisodes();
  }else{
    loginBox.style.display="block";
    panel.style.display="none";
  }
});

function login(){
 auth.signInWithEmailAndPassword(loginEmail.value, loginPass.value)
 .catch(e=>msg.innerText=e.message);
}

function logout(){ auth.signOut(); }

/* ===== ANIME ===== */
function saveAnime(){
 let data={
  name:aName.value,
  img:aImg.value,
  lang:aLang.value,
  genre:aGenre.value,
  type:aType.value,
  desc:aDesc.value
 };

 if(editAnimeId){
  db.collection("anime").doc(editAnimeId).update(data);
  editAnimeId=null;
 }else{
  db.collection("anime").add(data);
 }
 clearAnime();
}

function loadAnime(){
 animeList.innerHTML="";
 animeSelect.innerHTML="";
 db.collection("anime").onSnapshot(snap=>{
  animeList.innerHTML="";
  animeSelect.innerHTML="";
  snap.forEach(doc=>{
   let a=doc.data();
   animeList.innerHTML+=`
    <div class="card">
     <b>${a.name}</b><br>
     ${a.genre} | ${a.lang} | ${a.type}
     <button onclick="editAnime('${doc.id}')">Edit</button>
     <button onclick="delAnime('${doc.id}')">Delete</button>
    </div>`;
   animeSelect.innerHTML+=`<option value="${doc.id}">${a.name}</option>`;
  });
 });
}

function editAnime(id){
 db.collection("anime").doc(id).get().then(doc=>{
  let a=doc.data();
  aName.value=a.name;
  aImg.value=a.img;
  aLang.value=a.lang;
  aGenre.value=a.genre;
  aType.value=a.type;
  aDesc.value=a.desc;
  editAnimeId=id;
 });
}

function delAnime(id){
 if(confirm("Delete Anime?")){
  db.collection("anime").doc(id).delete();
 }
}

function clearAnime(){
 aName.value="";aImg.value="";aLang.value="";
 aGenre.value="";aDesc.value="";
}

/* ===== EPISODE ===== */
function saveEpisode(){
 let data={
  animeId:animeSelect.value,
  title:epTitle.value,
  link1:epLink1.value,
  link2:epLink2.value,
  link3:epLink3.value
 };

 if(editEpisodeId){
  db.collection("episodes").doc(editEpisodeId).update(data);
  editEpisodeId=null;
 }else{
  db.collection("episodes").add(data);
 }

 epTitle.value="";epLink1.value="";epLink2.value="";epLink3.value="";
}

function loadEpisodes(){
 episodeList.innerHTML="";
 db.collection("episodes").onSnapshot(snap=>{
  episodeList.innerHTML="";
  snap.forEach(doc=>{
   let e=doc.data();
   episodeList.innerHTML+=`
    <div class="card">
     ${e.title}
     <button onclick="editEpisode('${doc.id}')">Edit</button>
     <button onclick="delEpisode('${doc.id}')">Delete</button>
    </div>`;
  });
 });
}

function editEpisode(id){
 db.collection("episodes").doc(id).get().then(doc=>{
  let e=doc.data();
  animeSelect.value=e.animeId;
  epTitle.value=e.title;
  epLink1.value=e.link1;
  epLink2.value=e.link2;
  epLink3.value=e.link3;
  editEpisodeId=id;
 });
}

function delEpisode(id){
 if(confirm("Delete Episode?")){
  db.collection("episodes").doc(id).delete();
 }
}
</script>

</body>
</html
